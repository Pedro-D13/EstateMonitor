<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Getting Started: Serving Web Content</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="paho-mqtt.js"></script>


</head>
<body>
<H2 th:text="'Monitoring, ' + ${property} + ' ' + ${location} " />

<!--<div th:each="topic: ${propertyViewer.topicAddress}">-->
<!--    <p th:text="${topic}"></p>-->
<!--<input id="topic" type="text"  name="topic"  th:value="${topic}" />-->
<!--    <p id="Timestamp">No Updates </p>-->
<!--    <p id="Temperature">Unknown</p>-->
<!--    <script th:inline="javascript"> subscribe("home/thermostats/101/bedroom")</script>-->
<!--</div>-->

<div th:each="topic: ${topicList.topicAddress}">
<!--    <p id="topic" th:text="${topic}"></p>-->
    <input id="topic" type="text"  name="topic"  th:value="${topic}" />
</div>


<p th:id="Timestamp">No Updates </p>
<p th:id="Temperature">Unknown</p>



<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>-->

</body>
<script src="monitor.js"></script>
<script>
    $(document).ready(function(){
        console.log("Subscribing");

        // subscribe, requesting that message be delivered to function below
        let topic = $('#topic').val();
        console.log("Subscribe to " + topic);
        subscribeHomeMonitor(topic, processMonitorMessage);
    });

    // Exmple message processor
    function processMonitorMessage(message){
        console.log("processMonitorMessage:"+message.payloadString);
        let telemetry = JSON.parse(message.payloadString);
        $('#Timestamp').text( getFormattedDate(telemetry.date));
        $('#Temperature').text(telemetry.temperature);
    }

    // Date formatter
    function getFormattedDate(dateToFormat) {

        let formatter = Intl.DateTimeFormat(
            "default", // a locale name; "default" chooses automatically
            {
                weekday: "short",
                year: "numeric",
                month: "short",
                day: "numeric",
                hour: "numeric",
                minute: "numeric"
            }
        );
        return formatter.format(dateToFormat);
    }

</script>
</html>
